define(function(h,a){var d=h("jquery");h("bootstrap");String.prototype.contains=function(b){return this.indexOf(b)!=-1};String.prototype.startWith=function(b){return this.indexOf(b)==0};String.prototype.endWith=function(b){return this.length==0?false:this.indexOf(b)==this.length-1};String.prototype.inArray=function(b){if(this&&b)for(var c=0;c<b.length;c++)if(this==b[c])return true;return false};d.fn.qser=function(){var b={},c=d(this).serializeArray();if(c.length!=0)for(var e=0;e<c.length;e++)b[c[e].name]=
c[e].value;return b};d.fn.qdata=function(){var b={},c=d(this).attr("data");if(c){c=c.split(";");for(var e=0;e<c.length;e++)if(c[e]){var f=c[e].split(":");b[f[0]]=f[1]}}return b};a.ajaxoptions={url:"",data:{},type:"post",dataType:"json",async:false};a.ajaxopt=function(b){var c=d.extend({},a.ajaxoptions);if(typeof b=="string")c.url=b;else d.extend(c,b);return c};a.ajax=function(b){if(b){b=a.ajaxopt(b);b.url=base+b.url;var c;d.ajax(b).done(function(e){c=e});return c}else alert("need options")};a.html=
function(b,c){b=a.ajaxopt(b);b.dataType="html";d(c?c:"#cruddiv").empty().append(a.ajax(b))};a.ajaxinit=function(){qmask.qhide();d(document).ajaxStart(function(){qmask.qmask()});d(document).ajaxStop(function(){qmask.qhide()})};a.to=function(b){if(b)window.location.href=b;else alert("need url")};a.con=function(b){console.log(b)};a.on=function(b,c,e){d(document).off(c,b).on(c,b,e)};a.bs={};a.bs.modaloptions={url:"",fade:"fade",close:true,title:"title",btn:false,okbtn:"\u786e\u5b9a",qubtn:"\u53d6\u6d88",msg:"msg",big:false,
show:false,remote:false,backdrop:"static",keyboard:true};a.bs.modalstr=function(b){var c='<div class="modal '+b.fade+'" id="bsmodal" tabindex="-1" role="dialog" aria-labelledby="bsmodaltitle" aria-hidden="true" style="position:fixed;top:20px;">';c+=b.big?'<div class="modal-dialog modal-lg"><div class="modal-content">':'<div class="modal-dialog"><div class="modal-content">';var e='<div class="modal-header">';if(b.close)e+='<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>';
e+='<h3 class="modal-title" id="bsmodaltitle">'+b.title+"</h3></div>";var f='<div class="modal-body"><p><h4>'+b.msg+"</h4></p></div>",g='<div class="modal-footer"><button type="button" class="btn btn-primary bsok">'+b.okbtn+"</button>";if(b.btn)g+='<button type="button" class="btn btn-default bscancel">'+b.qubtn+"</button>";g+="</div>";return c+e+f+g+"</div></div></div>"};a.bs.alert=function(b,c){var e=d.extend({},a.bs.modaloptions);if(typeof b=="string")e.msg=b;else d.extend(e,b);e.title="\u63d0\u793a";d("body").append(a.bs.modalstr(e));
var f=d("#bsmodal");f.modal(e);a.on("button.bsok","click",function(){c&&c();f.modal("hide")});a.on("#bsmodal","hidden.bs.modal",function(){f.remove()});f.modal("show")};a.bs.confirm=function(b,c,e){var f=d.extend({},a.bs.modaloptions);if(typeof b=="string")f.msg=b;else d.extend(f,b);f.btn=true;f.title="\u786e\u8ba4\u64cd\u4f5c";d("body").append(a.bs.modalstr(f));var g=d("#bsmodal");g.modal(f);a.on("button.bsok","click",function(){c&&c();g.modal("hide")});a.on("button.bscancel","click",function(){e&&e();g.modal("hide")});
a.on("#bsmodal","hidden.bs.modal",function(){g.remove()});g.modal("show")};a.bs.dialog=function(b,c){var e=d.extend({},a.bs.modaloptions,b);d("body").append(a.bs.modalstr(e));b=a.ajax({url:b.url,dataType:"html"});d("#bsmodal div.modal-body").empty().append(b);var f=d("#bsmodal");f.modal(e);a.on("button.bsok","click",function(){var g=true;if(c)g=c();g&&f.modal("hide")});a.on("#bsmodal","hidden.bs.modal",function(){f.remove()});f.modal("show")};a.bs.msgoptions={msg:"msg",type:"info",time:2E3};a.bs.msgstr=
function(b,c){return'<div class="alert alert-'+c+' alert-dismissible" role="alert" style="display:none;position:fixed;top:0;left:0;width:100%;z-index:2001;margin:0;text-align:center;" id="bsalert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'+b+"</div>"};a.bs.msg=function(b){var c=d.extend({},a.bs.msgoptions);if(typeof b=="string")c.msg=b;else d.extend(c,b);d("body").prepend(a.bs.msgstr(c.msg,c.type));d("#bsalert").slideDown();
setTimeout(function(){d("#bsalert").slideUp(function(){d("#bsalert").remove()})},c.time)};a.crud={};a.crud.url="";a.crud.init=function(){a.on(".menus","click",function(){var b=d(this).qdata().url;if(b){a.crud.url=b;a.crud.list()}});a.crud.bindcrud();a.crud.bindpage()};a.crud.bindcrud=function(){a.on(".allcheck","change",function(){d(".onecheck").prop("checked",d(this).prop("checked"))});a.on(".addBtn","click",function(){a.crud.savep("\u6dfb\u52a0")});a.on(".editbtn","click",function(){a.crud.savep("\u4fee\u6539",d(this).parents("tr").qdata().id)});
a.on(".queBtn","click",function(){a.crud.savep("\u67e5\u8be2")});a.on(".relBtn","click",function(){a.crud.reset()});a.on(".delBtn","click",function(){a.crud.del()});a.on(".delbtn","click",function(){a.crud.del(d(this).parents("tr").qdata().id)})};a.crud.listopt={pageNumber:1};a.crud.list=function(b){var c={url:a.crud.url+"index"};b&&d.extend(a.crud.listopt,b);c.data=a.crud.listopt;a.html(c)};a.crud.reset=function(){a.crud.listopt={pageNumber:1};a.crud.list()};a.crud.savep=function(b,c){b=="\u67e5\u8be2"?a.bs.dialog({title:b,
url:a.crud.url+"savep"},function(){a.crud.list(d("#bsmodal").find("form").qser());return true}):a.bs.dialog({title:b,url:c?a.crud.url+"savep?id="+c:a.crud.url+"savep"},function(){a.crud.save();return true})};a.crud.save=function(){var b=a.ajax({url:a.crud.url+"save",data:d("#bsmodal").find("form").qser()});a.bs.msg(b.msg);a.crud.list()};a.crud.del=function(b){var c=[];b?c.push(b):d(".onecheck:checked").each(function(){c.push(d(this).parents("tr").qdata().id)});c.length?a.bs.confirm("\u786e\u8ba4\u8981\u5220\u9664\u6240\u9009\u8bb0\u5f55\u5417\uff1f",
function(){var e=a.ajax({url:a.crud.url+"del",data:{ids:c.join(",")}});a.bs.msg(e.msg);a.crud.list()}):a.bs.alert("\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u8bb0\u5f55\uff01")};a.crud.bindpage=function(){a.on(".crudfirst","click",function(){d(this).parent().hasClass("disabled")||a.crud.reset()});a.on(".crudprev","click",function(){d(this).parent().hasClass("disabled")||a.crud.list({pageNumber:a.crud.listopt.pageNumber-1})});a.on(".crudnext","click",function(){d(this).parent().hasClass("disabled")||a.crud.list({pageNumber:a.crud.listopt.pageNumber+
1})});a.on(".crudlast","click",function(){d(this).parent().hasClass("disabled")||a.crud.list({pageNumber:d(this).qdata().page})});a.on(".cruda","click",function(){d(this).parent().hasClass("disabled")||a.crud.list({pageNumber:parseInt(d(this).text())})});a.on(".crudgo","click",function(){var b=parseInt(d(".crudinput").val()),c=parseInt(d(this).qdata().page);b>=1&&b<=c&&a.crud.list({pageNumber:b})})}});
